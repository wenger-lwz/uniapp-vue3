{% comment %}
商品轮播
布局: tw-text-left tw-text-center
{% endcomment %}
{% assign collection = collections[section.settings.collection.id] %}
{% assign products = collection.products %}
{% assign productsSize = products.size %}
{% assign limit = section.settings.num %}
{% assign text_layout = 'product_switch-' | append: section.id | append: '-layout' %}
{% assign spacing = section.settings.spacing | divided_by: 2 %}
{% assign width = 1 | divided_by: section.settings.columns | times: 100 %}
{% assign isDefault = false %}
{% if productsSize == nil or productsSize == 0 or collection.products_count == 0 %}
  {% assign isDefault = true %}
{% endif %}
{% assign padding_top = section.settings.padding.top | default: "0" %}
{% assign padding_bottom = section.settings.padding.bottom | default: "0" %}
{% if section.settings.padding.right == blank and section.settings.padding.left == blank %}
  {% assign padding_right = section.settings.padding.right | default: settings.general_layout_spacing %}
  {% assign padding_left = section.settings.padding.left | default: settings.general_layout_spacing %}
{% else %}
  {% assign padding_right = section.settings.padding.right | default: 0 %}
  {% assign padding_left = section.settings.padding.left | default: 0 %}
{% endif %}
<style>
  .{{text_layout}}{
    text-align: {{section.settings.text_layout}};
  }
  .product_switch-{{section.id}}-container{
    max-width:{% if section.settings.max_container_width == blank %}var(--general-layout-width){% else %}{{section.settings.max_container_width}}px{% endif %};
    padding-top:{{padding_top | times: 0.6 }}px;
    padding-bottom:{{padding_bottom | times: 0.6 }}px;
  }
  .product_switch-{{section.id}}-list > .product_switch-{{section.id}}-list-item{
    padding: 0 7.5px;
    margin-bottom: 1px;/* margin-bottom：1px,解决safari有1px被遮挡的问题 */
  }
  .product_switch-{{section.id}}-list-wrap{
    margin: 0 -7.5px;
  }
  @media (min-width: {{settings.breakpoint}}px) {
    .product_switch-{{section.id}}-container{
      padding-top:{{padding_top}}px;
      padding-right:{{padding_right}}px;
      padding-bottom:{{padding_bottom}}px;
      padding-left:{{padding_left}}px;
    }
    .product_switch-{{section.id}}-title{
      font-size: {{section.settings.title_font_size}}px;
      letter-spacing:{{section.settings.title_letter_spacing}}px;
    }
    .product_switch-{{section.id}}-desc{
      font-size:{{section.settings.desc_font_size}}px;
      letter-spacing:{{section.settings.desc_letter_spacing}}px;
      line-height:{{section.settings.desc_line_height}};
    }
    .product_switch-{{section.id}}-list > .product_switch-{{section.id}}-list-item{
      width: {{width}}%;
      padding: 0 {{spacing}}px;
    }
    .product_switch-{{section.id}}-list-wrap{
      margin: 0 -{{spacing}}px;
    }
  }
</style>
<div class="tw-text-center" style="background:{{section.settings.color_section_bg}}">
  <div class="md:tw-px-5 tw-mx-auto hide-scrollbar product_switch-{{section.id}}-container">
    {% unless section.settings.title == blank %}
      <h3
        class="tw-m-0 tw-text-lg tw-leading-none type-heading-font-family {%if section.settings.title_uppercase_on%}tw-uppercase{%endif%} product_switch-{{section.id}}-title"
        style="color:{{section.settings.color_title_text}};">
        {{section.settings.title}}
      </h3>
    {% endunless %}
    {% unless section.settings.desc == blank %}
      <div class="tw-max-w-150 tw-mt-3 lg:tw-mt-4 tw-mx-auto tw-text-sm tw-leading-1.3 product_switch-{{section.id}}-desc"
        style="color:{{section.settings.color_desc_text}};">
        {{section.settings.desc}}
      </div>
    {% endunless %}
    <div class="tw-group tw-relative tw-pt-6 lg:tw-pt-10 product_switch-{{section.id}}-list-wrap">
      {% if limit > section.settings.columns %}
        <div class="tw-w-full tw-absolute product_switch-{{section.id}}-pagination-wrap">
          <div class="tw-hidden lg:tw-block tw-opacity-0 tw-absolute tw-z-10 tw-top-1/2 tw-left-6 lg:tw-left-7 tw-transform tw--translate-y-1/2 tw-cursor-pointer product_switch-{{section.id}}-pagination" data-direction="prev">
          {% include 'icon_bg_arrow', class: "tw-max-w-11 tw-max-h-11 tw-min-w-11 tw-min-h-11", icon_class: "tw-text-btn-bg-color" %}</div>
          <div class="tw-hidden lg:tw-block tw-opacity-0 tw-absolute tw-z-10 tw-top-1/2 tw-right-6 lg:tw-right-7 tw-transform tw--translate-y-1/2 tw-cursor-pointer product_switch-{{section.id}}-pagination" data-direction="next">{% include 'icon_bg_arrow', class: "tw-max-w-11 tw-max-h-11 tw-min-w-11 tw-min-h-11", icon_class:"tw-transform tw-rotate-180 tw-text-btn-bg-color" %}</div>
        </div>
      {% endif %}
      <div class="tw-flex tw-overflow-auto product_switch-{{section.id}}-list">
        {% if isDefault %}
          {% for i in (1..limit) %}
            <div class="tw-w-1/2 {% if productsSize > 2 and limit > 2 %}md:tw-w-9/20{% endif %} tw-flex-shrink-0 tw-box-border product_switch-{{section.id}}-list-item">
              {% include 'product', product: default_product, item_class: text_layout %}
            </div>
          {% endfor %}
        {% else %}
          {% for product in products limit:limit %}
            <div class="tw-w-1/2 {% if productsSize > 2 and limit > 2 %}md:tw-w-9/20{% endif %} tw-flex-shrink-0 tw-box-border product_switch-{{section.id}}-list-item">
              {% include 'product', product: product, item_class: text_layout %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% javascript %}
  $(function(){
    $(document).on("click", ".product_switch-{{section.id}}-pagination", function () {
      var $container = $(".product_switch-{{section.id}}-container")
      var $list = $(".product_switch-{{section.id}}-list")
      var distance = $container.find(".product_switch-{{section.id}}-list > .product_switch-{{section.id}}-list-item:first").outerWidth();
      $list.stop().animate(
        { scrollLeft: $list.scrollLeft() + { prev: -1, next: 1 }[$(this).data("direction")] * distance },
        { duration: "150", easing: "linear" }
      );
    }).one('mouseout', '.product_switch-{{section.id}}-list-wrap', function(){
      $('.product_switch-{{section.id}}-pagination-wrap').css({'padding-bottom':$('.product_switch-{{section.id}}-list-item:first .product-snippet__img-wrapper').outerHeight()})
      $('.product_switch-{{section.id}}-pagination').addClass('lg:group-hover:tw-opacity-100')
    });
  })
{% endjavascript %}

{% schema %}
{
  "name": "product_switch",
  "settings": [
    {
      "type": "header",
      "content": {
        "en-US": "Content",
        "zh-CN": "内容"
      }
    },
    {
      "type": "collection",
      "id": "collection",
      "label": {
        "en-US": "Add collection",
        "zh-CN": "添加专辑"
      }
    },
    {
      "type": "header",
      "content": {
        "en-US": "Settings",
        "zh-CN": "设置"
      }
    },
    {
      "type": "text",
      "id": "title",
      "label": {
        "en-US": "Title",
        "zh-CN": "标题"
      },
      "placeholder": {
        "zh-CN": "标题",
        "en-US": "Title"
      },
      "default": "Best Sellers"
    },
    {
      "type": "textarea",
      "id": "desc",
      "label": {
        "en-US": "Description",
        "zh-CN": "描述"
      },
      "placeholder": {
        "zh-CN": "请输入描述",
        "en-US": "Enter description"
      },
      "default": "Hundreds of products from the same manufacturers as the top luxury brands at unparalleled prices."
    },
    {
      "type": "select",
      "id": "text_layout",
      "label": {
        "en-US": "Text layout",
        "zh-CN": "文字布局"
      },
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": {
            "zh-CN": "居左",
            "en-US": "Left"
          }
        },
        {
          "value": "center",
          "label": {
            "zh-CN": "居中",
            "en-US": "Center"
          }
        }
      ]
    },
    {
      "type": "select",
      "id": "spacing",
      "label": {
        "en-US": "Space",
        "zh-CN": "格子间距"
      },
      "default": "30px",
      "options": [
        {
          "value": "15px",
          "label": {
            "en-US": "15px",
            "zh-CN": "15px"
          }
        },
        {
          "value": "20px",
          "label": {
            "en-US": "20px",
            "zh-CN": "20px"
          }
        },
        {
          "value": "30px",
          "label": {
            "en-US": "30px",
            "zh-CN": "30px"
          }
        },
        {
          "value": "40px",
          "label": {
            "en-US": "40px",
            "zh-CN": "40px"
          }
        }
      ]
    },
    {
      "type": "range",
      "id": "columns",
      "step": 1,
      "max": 6,
      "min": 2,
      "label": {
        "en-US": "Columns",
        "zh-CN": "商品分栏"
      },
      "default": 4
    },
    {
      "type": "range",
      "id": "num",
      "step": 1,
      "max": 12,
      "min": 1,
      "label": {
        "en-US": "Show numbers",
        "zh-CN": "商品数量"
      },
      "default": 4
    },
    {
      "type": "header",
      "content": {
        "en-US": "Typography",
        "zh-CN": "字体排版"
      }
    },
    {
      "type": "checkbox",
      "label": {
        "zh-CN": "开启标题全大写",
        "en-US": "Uppercase heading"
      },
      "id": "title_uppercase_on",
      "default": false
    },
    {
      "type": "range",
      "id": "title_font_size",
      "step": 1,
      "max": 48,
      "min": 12,
      "label": {
        "zh-CN": "标题字号",
        "en-US": "Heading text size"
      },
      "default": 28,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "title_letter_spacing",
      "step": 0.1,
      "max": 2,
      "min": -2,
      "label": {
        "zh-CN": "标题字间距",
        "en-US": "Heading letter spacing"
      },
      "default": 0
    },
    {
      "type": "range",
      "id": "desc_font_size",
      "step": 1,
      "max": 18,
      "min": 12,
      "label": {
        "zh-CN": "描述字号",
        "en-US": "Description text size"
      },
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "desc_letter_spacing",
      "step": 0.1,
      "max": 2,
      "min": -2,
      "label": {
        "en-US": "Description letter spacing",
        "zh-CN": "描述字间距"
      },
      "default": 0
    },
    {
      "type": "range",
      "id": "desc_line_height",
      "step": 0.1,
      "max": 3,
      "min": 1,
      "label": {
        "en-US": "Description line height",
        "zh-CN": "描述行高"
      },
      "default": 1.7
    },
    {
      "type": "header",
      "content": {
        "en-US": "Color",
        "zh-CN": "颜色"
      }
    },
    {
      "type": "color",
      "id": "color_section_bg",
      "label": {
        "en-US": "Background",
        "zh-CN": "背景"
      },
      "default": "#ffffff"
    },
    {
      "type": "paragraph",
      "content": {
        "zh-CN": "请使用浅色背景",
        "en-US": "Use a light background"
      }
    },
    {
      "type": "color",
      "id": "color_title_text",
      "label": {
        "zh-CN": "标题",
        "en-US": "Heading"
      },
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "color_desc_text",
      "label": {
        "en-US": "Description",
        "zh-CN": "描述"
      },
      "default": "#666666"
    },
    {
      "type": "header",
      "content": {
        "en-US": "Layout",
        "zh-CN": "布局"
      }
    },
    {
      "type": "padding",
      "id": "padding",
      "label": {
        "en-US": "Content space",
        "zh-CN": "内容留白"
      },
      "default": {
        "top": "80",
        "right": "",
        "bottom": "80",
        "left": ""
      },
      "info": {
        "zh-CN": "内容留白单位为px",
        "en-US": "Content space unit in px"
      }
    },
    {
      "type": "text",
      "id": "max_container_width",
      "label": {
        "en-US": "Max content width",
        "zh-CN": "最大内容宽度"
      },
      "default": "",
      "props": {
        "type": "number"
      },
      "placeholder": {
        "zh-CN": "请输入最大内容宽度",
        "en-US": "Enter Max content width"
      },
      "info": {
        "zh-CN": "最大内容宽度单位为px",
        "en-US": "Max content width unit in px"
      }
    }
  ],
  "presets": [
    {
      "name": "product_switch",
      "cname": {
        "en-US": "Products switch",
        "zh-CN": "商品轮播"
      },
      "category": {
        "en-US": "Product",
        "zh-CN": "商品"
      },
      "ccategory": {
        "en-US": "Product",
        "zh-CN": "商品"
      },
      "icon": "oss/operation/cbff8870e3db05817270bcb0e8c52870.svg",
      "display": true
    }
  ]
}
{% endschema %}