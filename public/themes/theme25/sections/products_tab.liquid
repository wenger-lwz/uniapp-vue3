{% comment %}
商品切换
布局: tw-text-left tw-text-center
商品分栏: lg:tw-grid-cols-2 lg:tw-grid-cols-3 lg:tw-grid-cols-4 lg:tw-grid-cols-5 lg:tw-grid-cols-6
{% endcomment %}
{% assign limit = section.settings.rows | times: section.settings.columns %}
{% assign text_layout = 'products_tab-' | append: section.id | append: '-layout' %}
{% assign padding_top = section.settings.padding.top | default: "0" %}
{% assign padding_bottom = section.settings.padding.bottom | default: "0" %}
{% if section.settings.padding.right == blank and section.settings.padding.left == blank %}
  {% assign padding_right = section.settings.padding.right | default: settings.general_layout_spacing %}
  {% assign padding_left = section.settings.padding.left | default: settings.general_layout_spacing %}
{% else %}
  {% assign padding_right = section.settings.padding.right | default: 0 %}
  {% assign padding_left = section.settings.padding.left | default: 0 %}
{% endif %}
<style>
  .{{text_layout}}{
    text-align: {{section.settings.text_layout}};
  }
  .products_tab-{{section.id}}-container{
    max-width:{% if section.settings.max_container_width == blank %}var(--general-layout-width){% else %}{{section.settings.max_container_width}}px{% endif %};
    padding-top:{{padding_top | times: 0.6 }}px;
    padding-bottom:{{padding_bottom | times: 0.6 }}px;
  }
  .products_tab-{{section.id}}-header{
    color: {{section.settings.color_title_text}};
  }
  .products_tab-{{section.id}}-header-checked{
    color: {{section.settings.color_title_selected_text}}
  }
  .products_tab-{{section.id}}-content{display:none;}
  .products_tab-{{section.id}}-cb:checked + .products_tab-{{section.id}}-content{
    display: grid;
  }
  @media (min-width: {{settings.breakpoint}}px) {
    .products_tab-{{section.id}}-container{
      padding-top:{{padding_top}}px;
      padding-right:{{padding_right}}px;
      padding-bottom:{{padding_bottom}}px;
      padding-left:{{padding_left}}px;
    }
    .products_tab-{{section.id}}-header{
      font-size: {{section.settings.title_font_size}}px;
      letter-spacing:{{section.settings.title_letter_spacing}}px;
    }
    .products_tab-{{section.id}}-content{
      grid-column-gap: {{section.settings.spacing}};
      column-gap: {{section.settings.spacing}};
    }
  }
</style>
<div class="tw-text-center" style="background:{{section.settings.color_section_bg}}">
  <div class="md:tw-px-5 tw-mx-auto hide-scrollbar products_tab-{{section.id}}-container">
    <div class="tw-whitespace-nowrap tw-overflow-x-auto tw-overflow-y-hidden tw-space-x-8 lg:tw-space-x-12 products_tab-{{section.id}}-header-wrap">
      {% for block in section.blocks %}
        <h3 class="tw-inline-block tw-flex-shrink-0 tw-m-0 tw-text-lg tw-leading-none type-heading-font-family {%if section.settings.title_uppercase_on%}tw-uppercase{%endif%} products_tab-{{section.id}}-header {% if forloop.index == 1 %}products_tab-{{section.id}}-header-checked{% endif %}">
          <label class="tw-cursor-pointer tw-leading-none" for="products_tab-{{ section.id }}-{{ forloop.index }}">
            {% if block.settings.collection.title != blank and block.settings.collection.id != 0 %}
              {{block.settings.collection.title}}
            {% else %}
              Tab Title
            {% endif %}
          </label>
        </h3>
      {% endfor %}
    </div>
    {% for block in section.blocks %}
      {% assign collection = collections[block.settings.collection.id] %}
      {% assign products = collection.products %}
      {% assign productsSize = products.size %}
      <input type="radio" name="products_tab-{{ section.id }}" class="tw-hidden products_tab-{{section.id}}-cb" id="products_tab-{{ section.id }}-{{ forloop.index }}" {% if forloop.index == 1 %}checked{% endif %} />
      <div class="md:tw-gap-x-px-15 tw-grid-cols-2 lg:tw-grid-cols-{{section.settings.columns}} tw-gap-y-7.5 lg:tw-gap-y-15 tw-pt-6 lg:tw-pt-10 products_tab-{{section.id}}-content">
        {% for product in products limit:limit %}
          {% include 'product', product: product, item_class: text_layout %}
        {% endfor %}
        {% if productsSize == nil or productsSize == 0 or collection.products_count == 0 %}
          {% for i in (1..limit) %}
            {% include 'product', product: default_product, item_class: text_layout %}
          {% endfor %}
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

{% javascript %}
  $(function(){
    $(document).on("click", ".products_tab-{{section.id}}-header", function (e) {
      var _for = $(this).find('label').attr('for');
      var $cb = $('input[id=' + _for + ']');
      $(this).siblings('.products_tab-{{section.id}}-header').removeClass('products_tab-{{section.id}}-header-checked');
      $(this).addClass('products_tab-{{section.id}}-header-checked');
      $('.products_tab-{{section.id}}-header-wrap').animate({
        scrollLeft: $(".products_tab-{{section.id}}-header-wrap").scrollLeft() + $(this).offset().left + $(this).width()/2 - $(window).width()/2
      }, 200);
    });
  })
{% endjavascript %}

{% schema %}
{
  "name": "products_tab",
  "settings": [
    {
      "type": "header",
      "content": {
        "en-US": "Settings",
        "zh-CN": "设置"
      }
    },
    {
      "type": "select",
      "id": "text_layout",
      "label": {
        "en-US": "Text layout",
        "zh-CN": "文字布局"
      },
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": {
            "zh-CN": "居左",
            "en-US": "Left"
          }
        },
        {
          "value": "center",
          "label": {
            "zh-CN": "居中",
            "en-US": "Center"
          }
        }
      ]
    },
    {
      "type": "select",
      "id": "spacing",
      "label": {
        "en-US": "Space",
        "zh-CN": "格子间距"
      },
      "default": "30px",
      "options": [
        {
          "value": "15px",
          "label": {
            "en-US": "15px",
            "zh-CN": "15px"
          }
        },
        {
          "value": "20px",
          "label": {
            "en-US": "20px",
            "zh-CN": "20px"
          }
        },
        {
          "value": "30px",
          "label": {
            "en-US": "30px",
            "zh-CN": "30px"
          }
        },
        {
          "value": "40px",
          "label": {
            "en-US": "40px",
            "zh-CN": "40px"
          }
        }
      ]
    },
    {
      "type": "range",
      "id": "columns",
      "step": 1,
      "max": 6,
      "min": 2,
      "label": {
        "en-US": "Columns",
        "zh-CN": "商品分栏"
      },
      "default": 4
    },
    {
      "type": "range",
      "id": "rows",
      "step": 1,
      "max": 3,
      "min": 1,
      "label": {
        "zh-CN": "商品行数",
        "en-US": "Number of rows"
      },
      "default": 1
    },
    {
      "type": "header",
      "content": {
        "en-US": "Typography",
        "zh-CN": "字体排版"
      }
    },
    {
      "type": "checkbox",
      "label": {
        "zh-CN": "开启标题全大写",
        "en-US": "Uppercase heading"
      },
      "id": "title_uppercase_on",
      "default": false
    },
    {
      "type": "range",
      "id": "title_font_size",
      "step": 1,
      "max": 48,
      "min": 12,
      "label": {
        "zh-CN": "标题字号",
        "en-US": "Heading text size"
      },
      "default": 24,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "title_letter_spacing",
      "step": 0.1,
      "max": 2,
      "min": -2,
      "label": {
        "zh-CN": "标题字间距",
        "en-US": "Heading letter spacing"
      },
      "default": 0
    },
    {
      "type": "header",
      "content": {
        "en-US": "Color",
        "zh-CN": "颜色"
      }
    },
    {
      "type": "color",
      "id": "color_section_bg",
      "label": {
        "en-US": "Background",
        "zh-CN": "背景"
      },
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_title_text",
      "label": {
        "zh-CN": "标题",
        "en-US": "Heading"
      },
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "color_title_selected_text",
      "label": {
        "zh-CN": "标题（选中）",
        "en-US": "Heading（Selected）"
      },
      "default": "#000000"
    },
    {
      "type": "header",
      "content": {
        "en-US": "Layout",
        "zh-CN": "布局"
      }
    },
    {
      "type": "padding",
      "id": "padding",
      "label": {
        "en-US": "Content space",
        "zh-CN": "内容留白"
      },
      "default": {
        "top": "80",
        "right": "",
        "bottom": "80",
        "left": ""
      },
      "info": {
        "zh-CN": "内容留白单位为px",
        "en-US": "Content space unit in px"
      }
    },
    {
      "type": "text",
      "id": "max_container_width",
      "label": {
        "en-US": "Max content width",
        "zh-CN": "最大内容宽度"
      },
      "default": "",
      "props": {
        "type": "number"
      },
      "placeholder": {
        "zh-CN": "请输入最大内容宽度",
        "en-US": "Enter Max content width"
      },
      "info": {
        "zh-CN": "最大内容宽度单位为px",
        "en-US": "Max content width unit in px"
      }
    },
    {
      "type": "header",
      "content": {
        "en-US": "Content",
        "zh-CN": "内容"
      }
    }
  ],
  "max_blocks": 5,
  "blocks": [
    {
      "type": "collection",
      "name": {
        "en-US": "Collection",
        "zh-CN": "专辑"
      },
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": {
            "en-US": "Add collection",
            "zh-CN": "添加专辑"
          }
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "products_tab",
      "cname": {
        "en-US": "Products tab",
        "zh-CN": "商品切换"
      },
      "category": {
        "en-US": "Product",
        "zh-CN": "商品"
      },
      "ccategory": {
        "en-US": "Product",
        "zh-CN": "商品"
      },
      "blocks": [
        {
          "type": "collection",
          "settings": {
            "collection": null
          }
        },
        {
          "type": "collection",
          "settings": {
            "collection": null
          }
        },
        {
          "type": "collection",
          "settings": {
            "collection": null
          }
        }
      ],
      "icon": "oss/operation/8990a295de3f25cb86a107ec18f70eca.svg",
      "display": true
    }
  ]
}
{% endschema %}
