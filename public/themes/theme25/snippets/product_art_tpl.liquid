<script type="text/html" id="product_art_tpl">
  <% var price = product.price || 0; %>
  <% var compareAtPrice = product.compare_at_price || 0; %>
  <% var title = product.title || ''; %>
  <% var id = product.id || ''; %>
  <% var url = product.url || ''; %>
  <% var type = product.type || ''; %>
  <% var isMock = product.isMock || false; %>
  <% var wrapperHeight = "100%" %>
  <% var status_label = "" %>
  <% var product_image_hover_on = false %>
  <% var from_on = false %>

  <% if ('{{settings.product_image_display}}' == 'natural') { %>
    <% wrapperHeight = $imports.image_padding_bottom(product.image.width, product.image.height,'unlimit'); %>
  <% } else if ('{{settings.product_image_display}}') { %>
    <% wrapperHeight = "{{settings.product_image_display}}"; %>
  <% } %>

  <% if (image_size) { %>
    <% wrapperHeight = image_size; %>
  <% } %>

  <% if (image_size == "auto") { %>
    <% wrapperHeight = $imports.image_padding_bottom(product.image.width, product.image.height, 'unlimit'); %>
  <% } %>

  {% comment %} 判断是否需要from {% endcomment %}
  <% if (product.price_max != product.price_min) { %>
    <% from_on = true; %>
  <% } %>

  {% comment %} 状态标签(异步目前拿不到专辑商品) {% endcomment %}
  <% if ('{{settings.product_label_sold_out_on}}' == true & product.available == false) { %>
    <% status_label = '{{ langs.general.product.sold_out | t }}' %>
  <% } else if ('{{settings.product_label_sale_on}}' == true && product.compare_at_price > product.price) { %>
    <% status_label = '{{ langs.general.product.sale | t }}' %>
  <% } %>

  {% comment %} hover 第2张图 {% endcomment %}
  {% if settings.product_image_hover_on %}
    <% if (product.images && product.images.length > 1 ) { %>
      <% product_image_hover_on = true %>
      <% var second_image = product.images[1] %>
    <% } %>
  {% endif %}

  <div class="product-snippet {% if settings.product_quick_view_on %}tw-relative tw-pb-14 tw-h-full tw-box-border {% endif %} <%= item_class || '' %> tw-text-{{settings.product_layout | default: 'left'}}" data-track-id="<%=id%>">
    <a <% if (!isMock) { %> href="<%=product.url%>" <% } %>
      class="tw-relative tw-block tw-overflow-hidden tw-w-full {%if settings.general_style == 'round'%}tw-rounded-lg{%endif%} product-snippet__img-wrapper common__img-wrapper_lazy <% if ( product_image_hover_on ) { %>product-snippet__img-hover<% } %>"
      style="padding-bottom: <%= wrapperHeight %>;">
      <img
        src="{{shop.default_img}}"
        class="tw-absolute tw-inset-0 tw-m-auto tw-h-full tw-w-full tw-object-cover {%if settings.general_style == 'round'%}tw-rounded-lg{%endif%} product-snippet__img-first lazyload"
        
        data-sizes="auto"
        data-src="<%= $imports.reset_image(product.image.src, '{width}') %>"
        alt="<%= product.image.alt || '' %>"
      >
       <% if ( product_image_hover_on ) { %>
        <img
          src="{{shop.default_img}}"
          class="tw-absolute tw-inset-0 tw-m-auto tw-h-full tw-w-full tw-object-cover tw-invisible {%if settings.general_style == 'round'%}tw-rounded-lg{%endif%} product-snippet__img-second lazyload"
          
          data-sizes="auto"
          data-src="<%= $imports.reset_image(second_image.src, '{width}') %>"
          alt="<%= second_image.alt || '' %>"
        >
      <% } %>
      {% comment %} 折扣标签 {% endcomment %}
      {% if settings.product_label_discount_on %}
        <% if (product.compare_at_price - product.price > 0) { %>
          <div class="tw-absolute tw-top-2 tw-left-2 lg:tw-top-4 lg:tw-left-4 tw-uppercase tw-leading-4 lg:tw-leading-5 tw-tracking-tight tw-text-xs tw-px-1 tw-bg-discount-label-bg-color tw-text-discount-label-text-color {%if settings.general_style == 'round'%}tw-rounded-full{%endif%} product-info__label product-info__header_tag">
            {% if settings.product_label_discount_format == 'percentage' %}
              -<%- product.off_ratio %>%
            {% elsif settings.product_label_discount_format == 'amount' %}
              <% var saved_amount = $imports.finance_money_with_symbol((product.compare_at_price -  product.price).toFixed(2)); %>
              <%- "{{ langs.product.product_detail.save_html | t }}".replace(/\{\{\s*saved_amount\s*\}\}/, saved_amount) %>
            {% endif %}
          </div>
        <% } %>
      {% endif %}
    </a>
    <% if (status_label) { %>
      <div class="tw-mt-6 tw-font-semibold tw-text-text-color tw-leading-none tw-text-sm lg:tw-text-status-label-font-size tw-tracking-status-label-letter-spacing {%if settings.type_status_label_same_with == 'heading'%}type-heading-font-family{%else%}type-text-font-family{%endif%} {%if settings.type_status_label_text_uppercase_on%}tw-uppercase{%endif%}">
        <%=status_label%>
      </div>
    <% } %>
    <h3 class="tw-m-0 tw-p-0 <% if (status_label) { %>tw-mt-2.5<% } else { %>tw-mt-5<% } %> product-snippet__title-normal xf_skin_product_list_title">
      <a <% if (product.url) { %> href="<%=product.url%>" <% } %>
        class="tw-block tw-no-underline tw-text-title-color type-heading-font-family tw-text-sm lg:tw-text-snippet-font-size tw-tracking-snippet-letter-spacing tw-leading-snippet-line-height {%if settings.type_snippet_text_uppercase_on%} tw-uppercase {%endif%} lg:tw-transition-opacity lg:tw-duration-300 lg:hover:tw-opacity-60">
        <%= title %>
      </a>
    </h3>
    <div class="tw-mt-2.5 tw-text-0 tw-leading-none product-snippet__price-wrapper">
      <div class="tw-inline-block tw-mr-2 tw-max-w-full tw-truncate tw-text-price-color tw-text-sm lg:tw-text-price-font-size {%if settings.type_price_same_with == 'heading'%}type-heading-font-family{%else%}type-text-font-family{%endif%}">
        <% if (from_on) { %>{{ langs.products.general.from | t }}<% } %><span class="money"><%= $imports.finance_money_with_symbol(price) %></span>
      </div>
      <% if (compareAtPrice * 1 > price * 1 && !from_on) { %>
        <del class="tw-inline-block tw-max-w-full tw-truncate tw-text-compare-at-price-color tw-text-sm lg:tw-text-price-font-size {%if settings.type_price_same_with == 'heading'%}type-heading-font-family{%else%}type-text-font-family{%endif%} money">
          <%= $imports.finance_money_with_symbol(compareAtPrice) %>
        </del>
      <% } %>
    </div>
    {% comment %} 色卡/缩略图 {% endcomment %}
    {% if settings.product_swatches_name and settings.product_swatches_collection_on %}
      <% for(var i = 0; i < (product.options && product.options.length); i++) { %>
        <% var option = product.options[i]; %>
        <% var option_name = option.name.toLowerCase(); %>
        {% assign product_swatches_name = settings.product_swatches_name | downcase %}
        <% if (option_name.indexOf('{{product_swatches_name}}') > -1 && option.values.length > 1) { %>
          <% var option_index = i; %>
          <% var values = ''; %>
          {% include 'colors' %}
          <% var colors = {{colors|json}} %>
          <div class="tw-relative tw-text-0 {% if settings.product_swatches_style == 'swatches' %} tw--mx-1 {% elsif settings.product_swatches_style == 'thumbnail' %} tw--mx-1.5 {% endif %}">
            {% comment %} 第一张商品图 {% endcomment %}
            <div class="tw-hidden product-snippet__variants_radio" data-product-variants='{"image":<%= product.image || {} %>}'></div>
            <% for(var j = 0; j < (product.variants && product.variants.length); j++) { %>
              <% var variant = product.variants[j]; %>
              <% var value = variant.options[option_index].value %>
              <% if (values.indexOf(value) == -1) { %>
                <% values = values + ',' + value; %>
                {% if settings.product_swatches_style == "swatches" %}
                  {% comment %} 色卡 {% endcomment %}
                  <% var color_value = value.toLowerCase(); %>
                  <% if (colors[color_value]) { %>
                    <div  style="background-color: <%=color_value%>;" class="tw-inline-block tw-box-border tw-cursor-pointer tw-rounded-full tw-h-4 tw-w-4 tw-mt-3 tw-mx-1 product-snippet__variants_radio" data-track="switch_swatches" data-product-variants='{"image":<%= variant.image || {} %>}'></div>
                  <% } %>
                {% elsif settings.product_swatches_style == "thumbnail" %}
                  {% comment %} 缩略图 {% endcomment %}
                  <% if (product.need_variant_image) { %>
                    <div class="tw-inline-block tw-box-border tw-w-8 tw-h-8 tw-mt-2.5 lg:tw-mt-3 tw-mx-1.5 tw-bg-cover tw-bg-center tw-bg-no-repeat tw-cursor-pointer {%if settings.general_style == 'round'%}tw-rounded{%endif%} lazyload product-snippet__variants_radio" data-bgset="<%=$imports.reset_image(variant.image.src, '64x')%>" data-sizes="auto" data-track="switch_swatches" data-product-variants='{"image":<%= variant.image || {} %>}'></div>
                  <% } %>
                {% endif %}
              <% } %>
            <% } %>
          </div>
        <% } %>
      <% } %>
    {% endif %}
    {% if settings.product_quick_view_on %}
    <button type="button" class="tw-w-full tw-absolute tw-inset-x-0 tw-bottom-0 tw-text-btn-bg-color tw-bg-transparent tw-border tw-border-btn-bg-color tw-text-btn-font-size tw-tracking-btn-letter-spacing {%if settings.type_button_same_with == 'heading'%}type-heading-font-family{%else%}type-text-font-family{%endif%} {%if settings.type_button_text_uppercase_on%}tw-uppercase{%endif%} tw-box-border tw-border-solid tw-outline-none tw-p-0 tw-h-10 tw-text-sm tw-cursor-pointer lg:hover:tw-text-btn-text-color lg:hover:tw-bg-btn-bg-color active:tw-text-btn-text-color active:tw-bg-btn-bg-color disabled:tw-opacity-40 disabled:tw-cursor-not-allowed {%if settings.general_style == 'round'%}tw-rounded{%endif%} quick-shop" <% if(!product.isMock){ %> data-quick-shop="<%=product.handle%>" data-track="quick_shop" data-track-product-id="<%=product.id%>" <% } %>  >
      {{ langs.general.product.quick_shop | t }}
    </button>
    {% endif %}
  </div>
</script>