{% comment %}
  description:  分页template
{% endcomment %}
{% capture arrow %}
  {% include 'icon_more' %}
{% endcapture %}
<script id="tpl-pagination" type="text/html">
  <div class="sep-pagination tw-flex tw-justify-center tw-items-center">

    <a class="sep-pagination__link sep-pagination__prev" href="javascript:;" data-page="<%= page-1 %>"
      <% if(page!=1){ %> style="pointer-events: auto; color: var(--color-general-text);opacity: 1;" <% } else { %> style="pointer-events: none; color: var(--color-general-text); opacity:0.32;" <% } %>
    >
      {{arrow}}
    </a>

    <% if(total<=delimiterPageSize){ %>
      <% for(var i=1;i<=total;i++){ %>
      <a class="sep-pagination__link <%= (page==i?"sep-pagination__link_active":"")  %>" data-page="<%= i %>" href="javascript:;"><%= i %></a>
      <% } %>
    <% }else{ %>
    <a class="sep-pagination__link <%= (page==1?"sep-pagination__link_active":"")  %>" data-page="1" href="javascript:;">1</a>
      <% if(page>3){ %>
      <span class="sep-pagination__more">...</span>
      <% } %>
      <% for(var i= $imports.clamp(page-1,2,total-3);i<= $imports.clamp(page+1,4,total-1) ;i++){ %>
      <a class="sep-pagination__link <%= (page==i?"sep-pagination__link_active":"")  %>" data-page="<%= i %>" href="javascript:;"><%= i %></a>
      <% } %>

      <% if(page<total-2){ %>
      <span class="sep-pagination__more">...</span>
      <% } %>

    <a class="sep-pagination__link <%= (page==total?"sep-pagination__link_active":"")  %>" data-page="<%= total %>" href="javascript:;"><%= total %></a>
    <% } %>

    <a class="sep-pagination__link sep-pagination__next" href="javascript:;" data-page="<%= page+1 %>"
      <% if(page!=total){ %> style="pointer-events: auto; color: var(--color-general-text);opacity: 1;" <% } else { %> style="pointer-events: none; color: var(--color-general-text);opacity:0.32;" <% } %> >
      {{arrow}}
    </a>

  </div>
</script>


<style>
  .sep-pagination__prev > svg {
    transform: rotate(90deg);
  }
  .sep-pagination__next > svg {
    transform: rotate(-90deg);
  }
  /* sep-pagination : block */
  .sep-pagination {
    height: 18px;
    line-height: 18px;
    font-size: 18px;
    text-align: center;
    /* link more pagesize : elements */
  }
  .sep-pagination a {
    color: var(--color-general-text);
    opacity:0.32;
    text-decoration: none;
  }
  .sep-pagination__link, .sep-pagination__more {
    font-size: 13px;
    padding: 0 8px;
    margin-left: 4px;
    display: inline-block;
    line-height: 30px;
    position: relative;
  }
  .sep-pagination__link::before, .sep-pagination__more::before {
    content: "";
    display: block;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
  }
  .sep-pagination__link {
    /* modifier: active */
  }
  .sep-pagination .sep-pagination__link_active {
    position: relative;
    color: var(--color-general-text);
    opacity:1;
  }
  .sep-pagination__link_active::before {
    border-bottom: 2px solid var(--color-general-text);
  }
  .sep-pagination__link:last-child {
    margin-right: 0;
  }
  .sep-pagination__sum {
    line-height: 32px;
    float: left;
  }
  .sep-pagination__pagesize {
    line-height: 32px;
    float: right;
  }
  .sep-pagination__prev, .sep-pagination__next, .sep-pagination__more {
    font-weight: 500;
  }
  .sep-pagination__prev::before, .sep-pagination__next::before, .sep-pagination__more::before {
    border: unset;
  }

  html[dir=rtl] .sep-pagination__next {
    right: unset;
    left: 0;
  }
</style>

<script type="text/javascript">
$(function() {
  $.fn.pagination = function(opt) {
    opt = $.extend(
      {
        labelPrev: '',
        labelNext: '',
        labelPageSize: '{} items per page',
        pageSize: 10,
        delimiterPageSize: 7, // > 7页,显示...
        onChange: function() {}
      },
      opt
    );
    template.defaults.imports.clamp = function(target, lower, upper) {
      return target > lower ? (target < upper ? target : upper) : lower;
    };
    var $this = this;
    $this.on("pagination-change",opt.onChange);
    this.html(template('tpl-pagination', opt)).off('click').on('click', '.sep-pagination__link', function(e) {
      var page = parseInt(e.currentTarget.getAttribute('data-page'), 10);
      if(page < 1 || page > opt.total) return;
      opt.page = page;
      $this.html(template('tpl-pagination', opt)).trigger('pagination-change', { page: page });
    });
    return this;
  };
})
</script>