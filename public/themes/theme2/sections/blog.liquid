<div class="container container-gap">
  {% if section.settings.title %}
    <div id="blog-{{section.id}}-title" {% if shop.env == 0 %} style="display:none" {% endif %} >
    {% include 'card_title',title: section.settings.title,titlePath: 'title'%}
    </div>
  {% endif %}
  <div id="blog-{{section.id}}-articles" class="row"></div>
  <div style="margin:3.5rem 0;text-align:center;display:none;" id="blog-{{section.id}}-viewall">
    <a href="{{section.settings.blog.url}}" class="btn btn-primary xf_skin_title_font">{{ langs.general.view.view_all | t }}</a>
  </div>
</div>
<style>.blogsection hr {
  margin: 0; }

.article__title {
  font-size: 32px;
  color: #383838;
  line-height: 48px; }

.article__date {
  font-size: 14px;
  color: #666666;
  line-height: 28px;
  margin-top: 20px;
  margin-bottom: 10px; }

.article__excerpt {
  font-size: 16px;
  color: #666666;
  line-height: 28px;
  margin-top: 20px;
  margin-bottom: 25px;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical; }

.article__readline {
  margin-bottom: 50px;
  margin-top: 10px; }

.article__read {
  font-size: 16px;
  font-weight: 600;
  color: #1b7ad5;
  line-height: 28px;
  flex-shrink: 0;
  margin-right: 10px; }

.article__blogs {
  font-size: 14px;
  color: #666666;
  line-height: 28px;
  word-break: break-all;
  text-align: right; }

[data-section-type='blog'] .container {
  padding: 0;
  margin-top: 56px; }

[data-section-type='blog'] .container .row {
  margin: 0 -12px; }

[data-section-type='blog'] .container .col-12 {
  padding: 0 12px; }

@media (max-width: 767.98px) {
  [data-section-type='blog'] .container {
    padding: 0 15px; } }
</style>
{% javascript %}
$(function(){
  var settings = {{ section.settings | json }};
  var sectionId = "{{section.id}}";
  (function(callback){
    if(settings.blog && settings.blog.id && settings.blog.url){
	  $.get(settings.blog.url + '?per_page=' + settings.size + '&page=1&tttt=1111').then(function(res){
        $("#blog-{{section.id}}-viewall")[res.count > settings.size?"show":"hide"]();
        callback(res.articles);
      })
    }else{
      callback([]);
    }
  })(function(arr){
    {% if shop.env == 1 %}
    arr = arr.concat(Array.apply(null, Array(settings.size-arr.length)).map(function(){
      return {url:"javascript:$.toast.show({content:'请添加博客专辑'});",published_at:"2019-06-14T00:30:47Z",author:"{{shop.name}}",title:"New Pattern Spotlight: The Micro-Stripe",excerpt:"With an expansive collection of solid and heather colors in our line, the idea of adding a pattern to our collection has naturally been for years",blogs:[{title:"category1"},{title:"category2"}]};
    }));
    {% endif %}
    arr.length && ($("#blog-{{section.id}}-title").show());
    $("#blog-{{section.id}}-articles").html(arr.map(function(a){
      return window.template("blogs-tpl", { article: a });
    }).join(""));
  });
});
{% endjavascript %}

<script id="blogs-tpl" type="text/html">
  <div class="col-12 col-md-6">
    <a href="<%= article.url %>" class="article__img">
      <div class="common__img-wrapper_lazy" style="padding-bottom: 57%;overflow:hidden;">
        {% assign defaultImg = '/themes/theme1/assets/image/5643xcrwee3.png' | img_url: '1080x' %}
        <% var src = article.image && article.image.src ? article.image.src : '{{defaultImg}}'; %>
        <img src="{{shop.default_img}}" data-src="<%= src %>"
          style="width: 100%;max-height: unset;"
          alt="<%= article.title %>" class="lazy lazyload">
      </div>
    </a>
    <div class="article__date">
    <% if (article.published_at) { %>
      <span><%= $imports.dateFormat($imports.toTimestamp(article.published_at), 'MM.dd.yyyy') %></span>
    <% } %>
    <% if (article.published_at && article.author) { %>
      <span style='margin:0 10px;'>|</span>
    <% } %>
    <% if (article.author) { %>
      <span><%= article.author %></span>
    <% } %>
    </div>
    <a href="<%= article.url %>" class="article__title two_line_text_truncate"><%= article.title %></a>
    <% if (article.excerpt) { %><div class="article__excerpt"><%= article.excerpt %></div><% } %>
    <hr>
    <div class="d-flex justify-content-between article__readline">
      <a href="<%= article.url %>" class="article__read">{{ langs.general.blog.read_more | t }}</a>
      <span class="article__blogs two_line_text_truncate">
        <% for (var i = 0; i < article.blogs.length; i++) { %>
          <%= article.blogs[i].title %><% if (i < article.blogs.length - 1) { %>,<% } %>
        <% } %>
      </span>
    </div>
  </div>
</script>


{% schema %}
{
  "name": "blog",
  "settings": [
    {
      "type": "header",
      "content": {
        "en-US": "Settings",
        "zh-CN": "设置"
      }
    },
    {
      "type": "text",
      "id": "title",
      "label": {
        "en-US": "Heading",
        "zh-CN": "标题"
      },
      "default": "Blog",
      "placeholder": "Blog"
    },
    {
      "type": "range",
      "label": {
        "zh-CN": "博客显示数量",
        "en-US": "Show blog posts"
      },
      "id": "size",
      "min": 1,
      "max": 8,
      "step": 1,
      "default": 8
    },
    {
      "type": "header",
      "content": {
        "en-US": "Content",
        "zh-CN": "内容"
      }
    },
    {
      "type": "blog",
      "id": "blog"
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "blog",
      "cname": {
        "zh-CN": "博客专辑",
        "en-US": "Blogs"
      },
      "category": {
        "en-US": "Material",
        "zh-CN": "素材"
      },
      "ccategory": {
        "en-US": "Material",
        "zh-CN": "素材"
      },
      "display": true,
      "blocks": [],
      "icon": "/themes/theme1/assets/image/672c0b2f4.svg"
    }
  ]
}
{% endschema %}